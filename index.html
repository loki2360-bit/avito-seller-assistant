<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Заказы</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    .form-group {
      margin-bottom: 12px;
    }
    label {
      display: block;
      margin-bottom: 4px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 6px;
      box-sizing: border-box;
    }
    button {
      margin: 8px 4px;
      padding: 8px 16px;
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.9;
    }
    .order {
      border: 1px solid #ccc;
      padding: 12px;
      margin: 12px 0;
      background: white;
      border-radius: 6px;
    }
    .actions {
      margin-top: 8px;
    }
    #timeGroup { display: none; }
    #sizeGroup { display: block; }
  </style>
</head>
<body>

<h2>Добавить новый заказ</h2>

<div class="form-group">
  <label>Номер заказа (например, ORD-12345)</label>
  <input type="text" id="orderNumber" placeholder="ORD-12345" />
</div>

<div class="form-group">
  <label>Тип детали</label>
  <select id="detailType">
    <option value="">— выберите —</option>
    <option value="(Распил)">Распил</option>
    <option value="(Лин. распил)">Лин. распил</option>
    <option value="(Время)">Время</option>
    <option value="(Пазы)">Пазы</option>
    <option value="(Фаска)">Фаска</option>
    <option value="(Склейка-)">Склейка-</option>
    <option value="(Склейка+)">Склейка+</option>
  </select>
</div>

<div id="sizeGroup">
  <div class="form-group">
    <label>Длина (м)</label>
    <input type="number" step="0.01" id="length" placeholder="2.8" />
  </div>
  <div class="form-group">
    <label>Ширина (м)</label>
    <input type="number" step="0.01" id="width" placeholder="0.23" />
  </div>
  <div class="form-group">
    <label>Количество</label>
    <input type="number" id="quantity" value="1" min="1" />
  </div>
</div>

<div id="timeGroup">
  <div class="form-group">
    <label>Время (минут)</label>
    <input type="number" id="minutes" value="60" min="1" />
  </div>
</div>

<button onclick="addOrder()">Добавить заказ</button>
<button onclick="saveToTXT()">Сохранить всё в TXT</button>

<div id="ordersList"></div>

<script>
  // Показ/скрытие полей в зависимости от типа
  document.getElementById('detailType').addEventListener('change', function() {
    const val = this.value;
    const sizeGroup = document.getElementById('sizeGroup');
    const timeGroup = document.getElementById('timeGroup');
    if (val === '(Время)') {
      sizeGroup.style.display = 'none';
      timeGroup.style.display = 'block';
    } else {
      sizeGroup.style.display = 'block';
      timeGroup.style.display = 'none';
    }
  });

  let orders = [];

  function addOrder() {
    const num = document.getElementById('orderNumber').value.trim();
    const type = document.getElementById('detailType').value;
    if (!num || !type) {
      alert('Укажите номер заказа и тип детали');
      return;
    }

    let orderData = { number: num, type: type };

    if (type === '(Время)') {
      const minutes = parseFloat(document.getElementById('minutes').value);
      if (isNaN(minutes) || minutes <= 0) {
        alert('Укажите корректное время (в минутах)');
        return;
      }
      // Тариф: 5 ₽ за минуту — измените при необходимости
      const sum = (minutes * 5).toFixed(2);
      orderData.minutes = minutes;
      orderData.sum = parseFloat(sum);
    } else {
      const len = parseFloat(document.getElementById('length').value);
      const wid = parseFloat(document.getElementById('width').value);
      const qty = parseInt(document.getElementById('quantity').value);
      if (isNaN(len) || isNaN(wid) || isNaN(qty) || len <= 0 || wid <= 0 || qty <= 0) {
        alert('Проверьте длину, ширину и количество');
        return;
      }
      // Тариф: 65 ₽ за м²
      const sum = (len * wid * qty * 65).toFixed(2);
      orderData.length = len;
      orderData.width = wid;
      orderData.quantity = qty;
      orderData.sum = parseFloat(sum);
    }

    orders.push(orderData);
    renderOrders();
    clearForm();
  }

  function clearForm() {
    document.getElementById('orderNumber').value = '';
    document.getElementById('detailType').selectedIndex = 0;
    document.getElementById('length').value = '';
    document.getElementById('width').value = '';
    document.getElementById('quantity').value = '1';
    document.getElementById('minutes').value = '60';
    // Сбросим видимость
    document.getElementById('sizeGroup').style.display = 'block';
    document.getElementById('timeGroup').style.display = 'none';
  }

  function renderOrders() {
    const container = document.getElementById('ordersList');
    container.innerHTML = '';

    orders.forEach((order, idx) => {
      const div = document.createElement('div');
      div.className = 'order';

      if (order.type === '(Время)') {
        div.innerHTML = `
          №${idx + 1}. ${order.number}<br>
          &nbsp;&nbsp;деталь ${order.type}<br>
          &nbsp;&nbsp;Время: ${order.minutes} мин<br>
          &nbsp;&nbsp;Сумма: ${order.sum} ₽<br>
        `;
      } else {
        div.innerHTML = `
          №${idx + 1}. ${order.number}<br>
          &nbsp;&nbsp;деталь ${order.type}<br>
          &nbsp;&nbsp;Длина: ${order.length} м<br>
          &nbsp;&nbsp;Ширина: ${order.width} м<br>
          &nbsp;&nbsp;Кол-во: ${order.quantity}<br>
          &nbsp;&nbsp;Сумма: ${order.sum} ₽<br>
        `;
      }

      div.innerHTML += `
        <div class="actions">
          <button onclick="editOrder(${idx})">Изменить</button>
          <button onclick="deleteOrder(${idx})" style="background:#777;">Удалить</button>
        </div>
      `;
      container.appendChild(div);
    });
  }

  function editOrder(index) {
    const o = orders[index];
    document.getElementById('orderNumber').value = o.number;
    document.getElementById('detailType').value = o.type;

    // Эмулируем выбор для показа нужных полей
    const detailSelect = document.getElementById('detailType');
    detailSelect.dispatchEvent(new Event('change'));

    if (o.type === '(Время)') {
      document.getElementById('minutes').value = o.minutes;
    } else {
      document.getElementById('length').value = o.length;
      document.getElementById('width').value = o.width;
      document.getElementById('quantity').value = o.quantity;
    }

    orders.splice(index, 1);
    renderOrders();
  }

  function deleteOrder(index) {
    if (confirm('Удалить заказ?')) {
      orders.splice(index, 1);
      renderOrders();
    }
  }

  function saveToTXT() {
    if (orders.length === 0) {
      alert('Нет заказов для сохранения');
      return;
    }

    let txt = 'ЗАКАЗЫ ЗА \n========================\n\n';
    orders.forEach((o, i) => {
      txt += `№${i + 1}. ${o.number}\n`;
      txt += `   деталь ${o.type}\n`;
      if (o.type === '(Время)') {
        txt += `   Время: ${o.minutes} мин\n`;
      } else {
        txt += `   Длина: ${o.length} м\n`;
        txt += `   Ширина: ${o.width} м\n`;
        txt += `   Кол-во: ${o.quantity}\n`;
      }
      txt += `   Сумма: ${o.sum} ₽\n`;
      txt += '---\n';
    });

    const blob = new Blob([txt], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'заказы.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
</script>

</body>
</html>
