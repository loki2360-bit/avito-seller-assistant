<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Заказы</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    .form-group {
      margin-bottom: 12px;
    }
    label {
      display: block;
      margin-bottom: 4px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 6px;
      box-sizing: border-box;
    }
    button {
      margin: 8px 4px;
      padding: 8px 16px;
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.9;
    }
    .order {
      border: 1px solid #ccc;
      padding: 12px;
      margin: 12px 0;
      background: white;
      border-radius: 6px;
    }
    .actions {
      margin-top: 8px;
    }
  </style>
</head>
<body>

<h2>Добавить новый заказ</h2>

<div class="form-group">
  <label>Номер заказа (например, ORD-12345)</label>
  <input type="text" id="orderNumber" placeholder="ORD-12345" />
</div>

<div class="form-group">
  <label>Тип детали</label>
  <select id="detailType" multiple size="6">
    <option value="(Лин. распил)">Лин. распил</option>
    <option value="(Время)">Время</option>
    <option value="(Пазы)">Пазы</option>
    <option value="(Фаска)">Фаска</option>
    <option value="(Склейка-)">Склейка-</option>
    <option value="(Склейка+)">Склейка+</option>
  </select>
</div>

<div class="form-group">
  <label>Длина (м)</label>
  <input type="number" step="0.01" id="length" placeholder="2.8" />
</div>

<div class="form-group">
  <label>Ширина (м)</label>
  <input type="number" step="0.01" id="width" placeholder="0.23" />
</div>

<div class="form-group">
  <label>Количество</label>
  <input type="number" id="quantity" value="1" min="1" />
</div>

<button onclick="addOrder()">Добавить заказ</button>
<button onclick="saveToTXT()">Сохранить всё в TXT</button>

<div id="ordersList"></div>

<script>
  let orders = [];

  function addOrder() {
    const num = document.getElementById('orderNumber').value.trim();
    const types = Array.from(document.getElementById('detailType').selectedOptions).map(opt => opt.value);
    const len = parseFloat(document.getElementById('length').value);
    const wid = parseFloat(document.getElementById('width').value);
    const qty = parseInt(document.getElementById('quantity').value);

    if (!num || types.length === 0 || isNaN(len) || isNaN(wid) || isNaN(qty)) {
      alert('Заполните все поля корректно');
      return;
    }

    // Пример расчёта суммы: площадь * коэффициент * количество
    const sum = (len * wid * qty * 65).toFixed(2); // 65 ₽/м² — можно изменить

    const order = {
      number: num,
      types: types,
      length: len,
      width: wid,
      quantity: qty,
      sum: parseFloat(sum)
    };

    orders.push(order);
    renderOrders();
    clearForm();
  }

  function clearForm() {
    document.getElementById('orderNumber').value = '';
    document.getElementById('detailType').selectedIndex = -1;
    document.getElementById('length').value = '';
    document.getElementById('width').value = '';
    document.getElementById('quantity').value = '1';
  }

  function renderOrders() {
    const container = document.getElementById('ordersList');
    container.innerHTML = '';

    orders.forEach((order, idx) => {
      const div = document.createElement('div');
      div.className = 'order';

      const typesStr = order.types.join(' ');
      div.innerHTML = `
        №${idx + 1}. ${order.number}<br>
        &nbsp;&nbsp;деталь (Распил) ${typesStr}<br>
        &nbsp;&nbsp;Длина: ${order.length} м<br>
        &nbsp;&nbsp;Ширина: ${order.width} м<br>
        &nbsp;&nbsp;Кол-во: ${order.quantity}<br>
        &nbsp;&nbsp;Сумма: ${order.sum} ₽<br>
        <div class="actions">
          <button onclick="editOrder(${idx})">Изменить</button>
          <button onclick="deleteOrder(${idx})" style="background:#777;">Удалить</button>
        </div>
      `;
      container.appendChild(div);
    });
  }

  function editOrder(index) {
    const o = orders[index];
    document.getElementById('orderNumber').value = o.number;
    // Сбросить выбор, затем установить нужные
    const sel = document.getElementById('detailType');
    for (let i = 0; i < sel.options.length; i++) {
      sel.options[i].selected = o.types.includes(sel.options[i].value);
    }
    document.getElementById('length').value = o.length;
    document.getElementById('width').value = o.width;
    document.getElementById('quantity').value = o.quantity;

    // Удаляем старую запись после редактирования
    orders.splice(index, 1);
    renderOrders();
  }

  function deleteOrder(index) {
    if (confirm('Удалить заказ?')) {
      orders.splice(index, 1);
      renderOrders();
    }
  }

  function saveToTXT() {
    if (orders.length === 0) {
      alert('Нет заказов для сохранения');
      return;
    }

    let txt = 'ЗАКАЗЫ ЗА \n========================\n\n';
    orders.forEach((o, i) => {
      txt += `№${i + 1}. ${o.number}\n`;
      txt += `   деталь (Распил) ${o.types.join(' ')}\n`;
      txt += `   Длина: ${o.length} м\n`;
      txt += `   Ширина: ${o.width} м\n`;
      txt += `   Кол-во: ${o.quantity}\n`;
      txt += `   Сумма: ${o.sum} ₽\n`;
      txt += '---\n';
    });

    const blob = new Blob([txt], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'заказы.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
</script>

</body>
</html>
