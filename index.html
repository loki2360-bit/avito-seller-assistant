<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–æ—Ñ–µ–π–Ω–∞—è –ö–∞—Ä—Ç–∞ ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      padding: 16px;
      background: #f5f5f5;
      color: #212121;
      margin: 0;
    }
    h1 {
      margin-top: 0;
      font-size: 1.8rem;
      color: #5d4037;
    }
    .map-container {
      position: relative;
      width: 100%;
      height: 70vh;
      background: #e3f2fd; /* –°–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π —Ñ–æ–Ω –∫–∞–∫ "–∫–∞—Ä—Ç–∞" */
      border-radius: 12px;
      overflow: hidden;
      box-shadow: inset 0 0 8px rgba(0,0,0,0.1);
      cursor: pointer;
    }
    .spot {
      position: absolute;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .spot:hover {
      transform: translate(-50%, -50%) scale(1.25);
      z-index: 10;
    }
    .spot.cafe { background: #5d4037; }     /* –ö–æ—Ñ–µ–π–Ω—è ‚Äî –∫–æ—Ä–∏—á–Ω–µ–≤–∞—è */
    .spot.vending { background: #0288d1; }  /* –í–µ–Ω–¥–∏–Ω–≥ ‚Äî —Å–∏–Ω–∏–π */
    .controls {
      margin: 16px 0;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: #4caf50;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background: #388e3c; }
    button.secondary {
      background: #616161;
    }
    button.secondary:hover { background: #424242; }
    button.export { background: #2196f3; }
    button.export:hover { background: #0b7dda; }
    input[type="file"] {
      display: none;
    }
    .file-btn {
      padding: 10px 16px;
      background: #ff9800;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      display: inline-block;
    }
    .file-btn:hover { background: #f57c00; }
    .status {
      margin-top: 12px;
      font-size: 14px;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>‚òï –õ–æ–∫–∞–ª—å–Ω–∞—è –∫–æ—Ñ–µ–π–Ω–∞—è –∫–∞—Ä—Ç–∞</h1>

  <div class="controls">
    <button id="addCafe">‚ûï –ö–æ—Ñ–µ–π–Ω—è</button>
    <button id="addVending">ü•§ –í–µ–Ω–¥–∏–Ω–≥</button>
    <button class="export" id="exportBtn">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
    <label class="file-btn">
      üì• –ò–º–ø–æ—Ä—Ç –∏–∑ —Ñ–∞–π–ª–∞
      <input type="file" id="importFile" accept=".json">
    </label>
    <button class="secondary" id="clearBtn">üóë –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
  </div>

  <div class="map-container" id="map"></div>

  <div class="status">
    üí° –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –æ–±–ª–∞—Å—Ç–∏, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É.<br>
    üí° –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –∏–∫–æ–Ω–∫–µ ‚Äî —á—Ç–æ–±—ã –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É (1‚Äì5).
  </div>

  <script>
    // === –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö ===
    const STORAGE_KEY = 'coffee_map_spots';
    let spots = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    let addMode = null; // 'cafe' –∏–ª–∏ 'vending'

    // === –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage ===
    function saveSpots() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(spots));
      renderMap();
    }

    // === –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç—ã ===
    function renderMap() {
      const map = document.getElementById('map');
      map.innerHTML = '';

      spots.forEach(spot => {
        const el = document.createElement('div');
        el.className = `spot ${spot.type}`;
        el.style.left = `${spot.x}%`;
        el.style.top = `${spot.y}%`;
        el.title = `${spot.name} ‚òÖ${spot.rating || 0}`;
        el.textContent = spot.rating > 0 ? spot.rating : '';

        el.addEventListener('click', (e) => {
          e.stopPropagation(); // –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–∫ –ø–æ —Ñ–æ–Ω—É
          const rating = prompt(`–û—Ü–µ–Ω–∏—Ç–µ "${spot.name}" (–æ—Ç 1 –¥–æ 5):`, spot.rating || '');
          const num = parseInt(rating);
          if (!isNaN(num) && num >= 1 && num <= 5) {
            spot.rating = num;
            saveSpots();
          }
        });

        map.appendChild(el);
      });
    }

    // === –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ ===
    function handleMapClick(e) {
      if (!addMode) return;

      const rect = e.currentTarget.getBoundingClientRect();
      const x = ((e.clientX - rect.left) / rect.width) * 100;
      const y = ((e.clientY - rect.top) / rect.height) * 100;

      const name = prompt(`–ù–∞–∑–≤–∞–Ω–∏–µ (${addMode === 'cafe' ? '–∫–æ—Ñ–µ–π–Ω–∏' : '–≤–µ–Ω–¥–∏–Ω–≥–∞'}):`);
      if (!name || !name.trim()) {
        addMode = null;
        return;
      }

      spots.push({
        name: name.trim(),
        type: addMode,
        x: parseFloat(x.toFixed(2)),
        y: parseFloat(y.toFixed(2)),
        rating: 0
      });

      addMode = null;
      saveSpots();
    }

    // === –≠–∫—Å–ø–æ—Ä—Ç –≤ —Ñ–∞–π–ª ===
    function exportData() {
      const dataStr = JSON.stringify(spots, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'coffee-map.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // === –ò–º–ø–æ—Ä—Ç –∏–∑ —Ñ–∞–π–ª–∞ ===
    function importData(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const data = JSON.parse(event.target.result);
          if (Array.isArray(data)) {
            spots = data;
            saveSpots();
          } else {
            alert('–§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∞—Å—Å–∏–≤ —Ç–æ—á–µ–∫.');
          }
        } catch (err) {
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–æ JSON.');
        }
      };
      reader.readAsText(file);
      e.target.value = ''; // —Å–±—Ä–æ—Å
    }

    // === –û—á–∏—Å—Ç–∫–∞ ===
    function clearAll() {
      if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç–æ—á–∫–∏?')) {
        spots = [];
        saveSpots();
      }
    }

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
    function init() {
      document.getElementById('addCafe').addEventListener('click', () => addMode = 'cafe');
      document.getElementById('addVending').addEventListener('click', () => addMode = 'vending');
      document.getElementById('exportBtn').addEventListener('click', exportData);
      document.getElementById('importFile').addEventListener('change', importData);
      document.getElementById('clearBtn').addEventListener('click', clearAll);
      document.getElementById('map').addEventListener('click', handleMapClick);

      renderMap();
    }

    init();
  </script>
</body>
</html>
